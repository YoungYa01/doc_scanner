<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£æ‰«ææµ‹è¯•é¡µé¢</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .upload-section {
            border-right: 1px solid #eee;
            padding-right: 30px;
        }

        @media (max-width: 768px) {
            .upload-section {
                border-right: none;
                border-bottom: 1px solid #eee;
                padding-right: 0;
                padding-bottom: 30px;
            }
        }

        .upload-area {
            border: 2px dashed #6a11cb;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s;
            background-color: #f9f7ff;
            cursor: pointer;
        }

        .upload-area:hover {
            background-color: #f0ebff;
        }

        .upload-area.dragover {
            background-color: #e6ddff;
            border-color: #4a00e0;
        }

        .upload-icon {
            font-size: 48px;
            color: #6a11cb;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(106, 17, 203, 0.4);
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .preview-section {
            display: flex;
            flex-direction: column;
        }

        .preview-container, .result-container {
            flex: 1;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f9f9f9;
        }

        .preview-image, .result-image {
            max-width: 100%;
            max-height: 400px;
            display: none;
        }

        .preview-placeholder, .result-placeholder {
            color: #999;
            text-align: center;
        }

        .result-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .result-info {
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
            display: none;
        }

        .result-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result-loading {
            background-color: #cce7ff;
            border: 1px solid #b3d9ff;
            color: #004085;
        }

        .detection-item {
            background: white;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .detection-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .confidence {
            background: #6a11cb;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .file-info {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .instructions {
            margin: 20px 0;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 5px;
            border-left: 4px solid #2575fc;
        }

        .instructions h3 {
            margin-bottom: 10px;
            color: #2575fc;
        }

        .instructions ul {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .image-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .image-comparison {
                grid-template-columns: 1fr;
            }
        }

        .image-box {
            text-align: center;
        }

        .image-box h3 {
            margin-bottom: 10px;
            color: #6a11cb;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>æ–‡æ¡£æ‰«ææœåŠ¡</h1>
        <p class="subtitle">ä¸Šä¼ å›¾ç‰‡è¿›è¡Œæ–‡æ¡£æ£€æµ‹å’Œè¯†åˆ« - è¿”å›è¯†åˆ«åçš„å›¾ç‰‡</p>
    </header>

    <div class="content">
        <div class="upload-section">
            <h2>ä¸Šä¼ å›¾ç‰‡</h2>
            <p>é€‰æ‹©æˆ–æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶åˆ°ä¸‹æ–¹åŒºåŸŸ</p>

            <div class="instructions">
                <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
                <ul>
                    <li>æ”¯æŒæ ¼å¼ï¼šJPEGã€PNGã€JPG</li>
                    <li>æ–‡ä»¶å¤§å°é™åˆ¶ï¼š10MB</li>
                    <li>ç³»ç»Ÿå°†è‡ªåŠ¨æ£€æµ‹å›¾ç‰‡ä¸­çš„æ–‡æ¡£åŒºåŸŸ</li>
                    <li>è¿”å›è¯†åˆ«åçš„å›¾ç‰‡ï¼ŒåŒ…å«æ£€æµ‹æ¡†</li>
                </ul>
            </div>

            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <h3>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</h3>
                <p>æ”¯æŒ JPEGã€PNG æ ¼å¼ï¼Œæœ€å¤§ 10MB</p>
                <input type="file" id="fileInput" class="file-input" accept="image/jpeg,image/png,image/jpg">
                <button class="btn" id="uploadBtn">é€‰æ‹©æ–‡ä»¶</button>
            </div>

            <div class="file-info" id="fileInfo" style="display: none;">
                <strong>å·²é€‰æ‹©æ–‡ä»¶ï¼š</strong> <span id="fileName"></span> (<span id="fileSize"></span>)
            </div>

            <button class="btn" id="submitBtn" disabled>å¼€å§‹æ‰«æ</button>
        </div>

        <div class="preview-section">
            <h2>è¯†åˆ«ç»“æœ</h2>

            <div class="image-comparison">
                <div class="image-box">
                    <h3>åŸå§‹å›¾ç‰‡</h3>
                    <div class="preview-container">
                        <img id="previewImage" class="preview-image" alt="åŸå§‹å›¾ç‰‡">
                        <div class="preview-placeholder" id="previewPlaceholder">
                            åŸå§‹å›¾ç‰‡é¢„è§ˆå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                        </div>
                    </div>
                </div>

                <div class="image-box">
                    <h3>è¯†åˆ«ç»“æœ</h3>
                    <div class="result-container">
                        <img id="resultImage" class="result-image" alt="è¯†åˆ«ç»“æœ">
                        <div class="result-placeholder" id="resultPlaceholder">
                            è¯†åˆ«ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
                        </div>
                    </div>
                </div>
            </div>

            <div class="result-info" id="resultInfo">
                <!-- ç»“æœä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
            </div>
        </div>
    </div>
</div>

<div class="image-processing-section container" style="margin-top: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 10px;">
    <h2>å›¾åƒå¤„ç†åŠŸèƒ½</h2>

    <div class="upload-area" style="border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 10px 0;">
        <input type="file" id="processFileInput" accept="image/*" style="display: none;">
        <button class="btn" onclick="document.getElementById('processFileInput').click()">é€‰æ‹©å¤„ç†å›¾ç‰‡</button>
        <div id="processFileInfo" style="margin-top: 10px;"></div>
    </div>

    <!-- å‚æ•°æ§åˆ¶åŒºåŸŸ -->
    <div class="parameter-controls" style="margin: 15px 0; padding: 15px; background: #f9f9f9; border-radius: 5px;">
        <h3>å¤„ç†å‚æ•°</h3>

        <!-- ç°åº¦å¤„ç†å‚æ•° -->
        <div id="grayscaleParams" class="param-group" style="display: none;">
            <label>ç°åº¦æ–¹æ³•:
                <select id="grayscaleMethod">
                    <option value="average">å¹³å‡å€¼æ³•</option>
                    <option value="luminosity">äº®åº¦åŠ æƒæ³•</option>
                    <option value="custom">è‡ªå®šä¹‰æƒé‡</option>
                </select>
            </label>
        </div>

        <!-- é”åŒ–å¤„ç†å‚æ•° -->
        <div id="sharpenParams" class="param-group" style="display: none;">
            <label>é”åŒ–å¼ºåº¦: <input type="range" id="sharpenIntensity" min="0.1" max="3.0" step="0.1" value="1.0">
                <span id="sharpenIntensityValue">1.0</span>
            </label>
            <label>
                <input type="checkbox" id="useUnsharpMask"> ä½¿ç”¨éé”åŒ–æ©è”½
            </label>
            <label id="sigmaLabel" style="display: none;">
                é«˜æ–¯æ¨¡ç³Šå¼ºåº¦: <input type="range" id="sharpenSigma" min="0.5" max="5.0" step="0.1" value="1.0">
                <span id="sharpenSigmaValue">1.0</span>
            </label>
        </div>

        <!-- é»‘ç™½å¤„ç†å‚æ•° -->
        <div id="blackWhiteParams" class="param-group" style="display: none;">
            <label>äºŒå€¼åŒ–æ–¹æ³•:
                <select id="blackWhiteMethod">
                    <option value="adaptive">è‡ªé€‚åº”é˜ˆå€¼</option>
                    <option value="otsu">å¤§æ´¥ç®—æ³•</option>
                    <option value="simple">ç®€å•é˜ˆå€¼</option>
                </select>
            </label>
            <label id="thresholdLabel" style="display: none;">
                é˜ˆå€¼: <input type="range" id="blackWhiteThreshold" min="0" max="255" value="127">
                <span id="blackWhiteThresholdValue">127</span>
            </label>
            <label id="blockSizeLabel">
                å—å¤§å°: <input type="range" id="blackWhiteBlockSize" min="3" max="31" step="2" value="11">
                <span id="blackWhiteBlockSizeValue">11</span>
            </label>
            <label id="cLabel">
                å¸¸æ•°C: <input type="range" id="blackWhiteC" min="0" max="10" value="2">
                <span id="blackWhiteCValue">2</span>
            </label>
            <label>
                <input type="checkbox" id="applyMorphology"> åº”ç”¨å½¢æ€å­¦æ“ä½œ
            </label>
        </div>

        <!-- å¢å¼ºå¤„ç†å‚æ•° -->
        <div id="enhanceParams" class="param-group" style="display: none;">
            <label>å¯¹æ¯”åº¦é™åˆ¶: <input type="range" id="enhanceClipLimit" min="1.0" max="10.0" step="0.5" value="3.0">
                <span id="enhanceClipLimitValue">3.0</span>
            </label>
            <label>ç½‘æ ¼å¤§å°: <input type="range" id="enhanceTileGridSize" min="2" max="16" step="2" value="8">
                <span id="enhanceTileGridSizeValue">8</span>
            </label>
            <label>äº®åº¦: <input type="range" id="enhanceBrightness" min="0.5" max="2.0" step="0.1" value="1.0">
                <span id="enhanceBrightnessValue">1.0</span>
            </label>
            <label>å¯¹æ¯”åº¦: <input type="range" id="enhanceContrast" min="0.5" max="2.0" step="0.1" value="1.0">
                <span id="enhanceContrastValue">1.0</span>
            </label>
            <label>
                <input type="checkbox" id="sharpenAfterEnhance"> å¢å¼ºåé”åŒ–
            </label>
        </div>
    </div>

    <div class="processing-buttons" style="display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0;">
        <button class="btn" onclick="processImage('grayscale')">ç°åº¦å¤„ç†</button>
        <button class="btn" onclick="processImage('sharpen')">é”åŒ–å¤„ç†</button>
        <button class="btn" onclick="processImage('blackWhite')">é»‘ç™½å¤„ç†</button>
        <button class="btn" onclick="processImage('enhance')">å¢å¼ºå¤„ç†</button>
    </div>

    <div class="processing-result" style="display: none;" id="processingResult">
        <h3>å¤„ç†ç»“æœ</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div>
                <h4>åŸå§‹å›¾ç‰‡</h4>
                <img id="originalProcessImage" style="max-width: 100%; max-height: 300px;">
            </div>
            <div>
                <h4>å¤„ç†ç»“æœ</h4>
                <img id="processedImage" style="max-width: 100%; max-height: 300px;">
            </div>
        </div>
        <div id="processingInfo" style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px;"></div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const submitBtn = document.getElementById('submitBtn');
        const uploadArea = document.getElementById('uploadArea');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const previewImage = document.getElementById('previewImage');
        const previewPlaceholder = document.getElementById('previewPlaceholder');
        const resultImage = document.getElementById('resultImage');
        const resultPlaceholder = document.getElementById('resultPlaceholder');
        const resultInfo = document.getElementById('resultInfo');

        // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
        uploadBtn.addEventListener('click', function () {
            fileInput.click();
        });

        // æ–‡ä»¶é€‰æ‹©å˜åŒ–äº‹ä»¶
        fileInput.addEventListener('change', function (e) {
            if (this.files.length > 0) {
                handleFileSelection(this.files[0]);
            }
        });

        // æ‹–æ‹½äº‹ä»¶å¤„ç†
        uploadArea.addEventListener('dragover', function (e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', function () {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', function (e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');

            if (e.dataTransfer.files.length > 0) {
                handleFileSelection(e.dataTransfer.files[0]);
            }
        });

        // æäº¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        submitBtn.addEventListener('click', function () {
            if (fileInput.files.length > 0) {
                uploadFile(fileInput.files[0]);
            }
        });

        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelection(file) {
            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg'];
            if (!allowedTypes.includes(file.type)) {
                alert('é”™è¯¯ï¼šè¯·é€‰æ‹© JPEG æˆ– PNG æ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å°
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                alert('é”™è¯¯ï¼šæ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆæœ€å¤§10MBï¼‰');
                return;
            }

            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'block';

            // å¯ç”¨æäº¤æŒ‰é’®
            submitBtn.disabled = false;

            // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
            const reader = new FileReader();
            reader.onload = function (e) {
                previewImage.src = e.target.result;
                previewImage.style.display = 'block';
                previewPlaceholder.style.display = 'none';

                // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
                resultImage.style.display = 'none';
                resultPlaceholder.style.display = 'block';
                resultInfo.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        // ä¸Šä¼ æ–‡ä»¶
        function uploadFile(file) {
            const formData = new FormData();
            formData.append('image', file);

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            resultInfo.style.display = 'block';
            resultInfo.className = 'result-info result-loading';
            resultInfo.innerHTML = '<h3>æ‰«æä¸­...</h3><p>æ­£åœ¨å¤„ç†æ‚¨çš„å›¾ç‰‡ï¼Œè¯·ç¨å€™</p>';
            submitBtn.disabled = true;

            // å‘é€è¯·æ±‚
            fetch('http://117.50.174.253:5006/doc_scan/scan', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        displaySuccessResult(data);
                    } else {
                        displayErrorResult(data.message || 'æ‰«æå¤±è´¥');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    displayErrorResult(`è¯·æ±‚å¤±è´¥: ${error.message}`);
                })
                .finally(() => {
                    submitBtn.disabled = false;
                });
        }

        // æ˜¾ç¤ºæˆåŠŸç»“æœ
        function displaySuccessResult(data) {
            resultInfo.className = 'result-info result-success';

            let resultHTML = `<h3>æ‰«ææˆåŠŸ</h3>`;
            resultHTML += `<p>${data.message}</p>`;
            // æ˜¾ç¤ºè¯†åˆ«åçš„å›¾ç‰‡
            if (data.data) {
                resultImage.src = 'data:image/jpeg;base64,' + data.data;
                resultImage.style.display = 'block';
                resultPlaceholder.style.display = 'none';
            }

            resultInfo.innerHTML = resultHTML;
        }

        // æ˜¾ç¤ºé”™è¯¯ç»“æœ
        function displayErrorResult(message) {
            resultInfo.className = 'result-info result-error';
            resultInfo.innerHTML = `
                    <h3>æ‰«æå¤±è´¥</h3>
                    <p>${message}</p>
                `;
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    });
</script>

<script>
let currentProcessImage = null;

// æ–‡ä»¶é€‰æ‹©äº‹ä»¶
document.getElementById('processFileInput').addEventListener('change', function(e) {
    if (this.files.length > 0) {
        const file = this.files[0];
        const fileInfo = document.getElementById('processFileInfo');
        fileInfo.innerHTML = `å·²é€‰æ‹©: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;

        // æ˜¾ç¤ºé¢„è§ˆ
        const reader = new FileReader();
        reader.onload = function(e) {
            currentProcessImage = e.target.result;
            document.getElementById('originalProcessImage').src = currentProcessImage;
            document.getElementById('processingResult').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
});

// å‚æ•°æ§åˆ¶é€»è¾‘
function showParams(processType) {
    // éšè—æ‰€æœ‰å‚æ•°ç»„
    document.querySelectorAll('.param-group').forEach(group => {
        group.style.display = 'none';
    });

    // æ˜¾ç¤ºå¯¹åº”å‚æ•°ç»„
    document.getElementById(processType + 'Params').style.display = 'block';
}

// é”åŒ–å‚æ•°æ§åˆ¶
document.getElementById('sharpenIntensity').addEventListener('input', function() {
    document.getElementById('sharpenIntensityValue').textContent = this.value;
});
document.getElementById('useUnsharpMask').addEventListener('change', function() {
    document.getElementById('sigmaLabel').style.display = this.checked ? 'block' : 'none';
});
document.getElementById('sharpenSigma').addEventListener('input', function() {
    document.getElementById('sharpenSigmaValue').textContent = this.value;
});

// é»‘ç™½å¤„ç†å‚æ•°æ§åˆ¶
document.getElementById('blackWhiteMethod').addEventListener('change', function() {
    const isSimple = this.value === 'simple';
    const isAdaptive = this.value === 'adaptive';

    document.getElementById('thresholdLabel').style.display = isSimple ? 'block' : 'none';
    document.getElementById('blockSizeLabel').style.display = isAdaptive ? 'block' : 'none';
    document.getElementById('cLabel').style.display = isAdaptive ? 'block' : 'none';
});
document.getElementById('blackWhiteThreshold').addEventListener('input', function() {
    document.getElementById('blackWhiteThresholdValue').textContent = this.value;
});
document.getElementById('blackWhiteBlockSize').addEventListener('input', function() {
    document.getElementById('blackWhiteBlockSizeValue').textContent = this.value;
});
document.getElementById('blackWhiteC').addEventListener('input', function() {
    document.getElementById('blackWhiteCValue').textContent = this.value;
});

// å¢å¼ºå¤„ç†å‚æ•°æ§åˆ¶
document.getElementById('enhanceClipLimit').addEventListener('input', function() {
    document.getElementById('enhanceClipLimitValue').textContent = this.value;
});
document.getElementById('enhanceTileGridSize').addEventListener('input', function() {
    document.getElementById('enhanceTileGridSizeValue').textContent = this.value;
});
document.getElementById('enhanceBrightness').addEventListener('input', function() {
    document.getElementById('enhanceBrightnessValue').textContent = this.value;
});
document.getElementById('enhanceContrast').addEventListener('input', function() {
    document.getElementById('enhanceContrastValue').textContent = this.value;
});

// å¤„ç†å›¾åƒ
function processImage(processType) {
    if (!currentProcessImage) {
        alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
        return;
    }

    // æ˜¾ç¤ºå¯¹åº”å‚æ•°
    showParams(processType);

    const resultDiv = document.getElementById('processingResult');
    const processedImg = document.getElementById('processedImage');
    const infoDiv = document.getElementById('processingInfo');

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    processedImg.src = '';
    infoDiv.innerHTML = 'å¤„ç†ä¸­...';

    // æ ¹æ®å¤„ç†ç±»å‹æ„å»ºå‚æ•°
    let params = {};
    switch(processType) {
        case 'grayscale':
            params = {
                method: document.getElementById('grayscaleMethod').value
            };
            break;
        case 'sharpen':
            params = {
                intensity: parseFloat(document.getElementById('sharpenIntensity').value),
                use_unsharp_mask: document.getElementById('useUnsharpMask').checked,
                sigma: parseFloat(document.getElementById('sharpenSigma').value)
            };
            break;
        case 'blackWhite':
            params = {
                method: document.getElementById('blackWhiteMethod').value,
                threshold: parseInt(document.getElementById('blackWhiteThreshold').value),
                block_size: parseInt(document.getElementById('blackWhiteBlockSize').value),
                c: parseInt(document.getElementById('blackWhiteC').value),
                apply_morphology: document.getElementById('applyMorphology').checked,
                kernel_size: 3
            };
            break;
        case 'enhance':
            params = {
                clip_limit: parseFloat(document.getElementById('enhanceClipLimit').value),
                tile_grid_size: parseInt(document.getElementById('enhanceTileGridSize').value),
                brightness: parseFloat(document.getElementById('enhanceBrightness').value),
                contrast: parseFloat(document.getElementById('enhanceContrast').value),
                sharpen_after_enhance: document.getElementById('sharpenAfterEnhance').checked
            };
            break;
    }

    // æ ¹æ®å¤„ç†ç±»å‹é€‰æ‹©APIç«¯ç‚¹
    let apiUrl = '';
    switch(processType) {
        case 'grayscale':
            apiUrl = '/doc_scan/grayscale/';
            break;
        case 'sharpen':
            apiUrl = '/doc_scan/sharpen/';
            break;
        case 'blackWhite':
            apiUrl = '/doc_scan/black-white/';
            break;
        case 'enhance':
            apiUrl = '/doc_scan/enhance/';
            break;
        default:
            alert('æœªçŸ¥çš„å¤„ç†ç±»å‹');
            return;
    }

    // å‘é€è¯·æ±‚
    fetch(apiUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            image: currentProcessImage,
            params: params
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            processedImg.src = data.processed_image;
            infoDiv.innerHTML = `
                <strong>å¤„ç†ç±»å‹:</strong> ${data.process_type}<br>
                <strong>å¤„ç†æ—¶é—´:</strong> ${(data.processing_time * 1000).toFixed(2)} ms<br>
                <strong>åŸå§‹å°ºå¯¸:</strong> ${data.original_size[0]} Ã— ${data.original_size[1]}<br>
                <strong>å¤„ç†å°ºå¯¸:</strong> ${data.processed_size[0]} Ã— ${data.processed_size[1]}<br>
                <strong>æ—¶é—´æˆ³:</strong> ${new Date(data.timestamp * 1000).toLocaleString()}
            `;
        } else {
            infoDiv.innerHTML = `<span style="color: red;">å¤„ç†å¤±è´¥: ${data.error}</span>`;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        infoDiv.innerHTML = `<span style="color: red;">è¯·æ±‚å¤±è´¥: ${error.message}</span>`;
    });
}
</script>

</body>
</html>